# Vercel部署问题排查指南

## 当前状态
- 部署成功，但访问时可能出现404错误
- 需要排查具体的问题原因

## 排查步骤

### 1. 检查部署日志
在Vercel控制台中查看部署日志，特别关注：
- 构建过程是否有错误
- 依赖安装是否成功
- 应用启动是否正常

### 2. 测试简单版本
当前使用 `api/test_index.py` 作为入口点，这是一个简单的Flask应用：
- 访问根路径 `/` 应该返回JSON响应
- 访问 `/health` 检查健康状态
- 访问 `/debug` 查看环境信息

### 3. 检查环境变量
确保在Vercel控制台中设置了：
- `OPENAI_API_KEY`: 你的OpenAI API密钥

### 4. 常见问题及解决方案

#### 问题1: 404 Not Found
**可能原因：**
- 路由配置错误
- 入口文件路径不正确
- Flask应用未正确导出

**解决方案：**
- 检查 `vercel.json` 中的路由配置
- 确保入口文件中有 `handler = app`
- 使用简单测试版本验证

#### 问题2: 依赖安装失败
**可能原因：**
- `requirements.txt` 中的包版本冲突
- 某些包在Vercel环境中不可用

**解决方案：**
- 简化依赖列表
- 使用兼容的包版本
- 移除不必要的依赖

#### 问题3: 应用启动失败
**可能原因：**
- 代码中有硬编码路径
- 环境变量未设置
- 权限问题

**解决方案：**
- 检查代码中的路径引用
- 确保所有环境变量都已设置
- 使用相对路径

### 5. 调试技巧

#### 查看Vercel函数日志
1. 在Vercel控制台中进入项目
2. 点击 "Functions" 标签
3. 查看函数执行日志

#### 本地测试
```bash
# 安装依赖
pip install -r requirements.txt

# 运行简单测试
python test_simple.py

# 测试主应用
python chatbot_web.py
```

#### 检查文件结构
确保项目结构正确：
```
chatbot第一版/
├── api/
│   ├── index.py          # 主入口文件
│   └── test_index.py     # 测试入口文件
├── templates/
│   └── index.html        # 前端模板
├── chatbot_web.py        # Flask主应用
├── requirements.txt      # 依赖列表
├── vercel.json          # Vercel配置
└── test_simple.py       # 简单测试应用
```

### 6. 下一步行动

1. **等待当前部署完成**
2. **访问应用URL测试简单版本**
3. **查看Vercel函数日志**
4. **根据日志信息进一步排查**

如果简单版本工作正常，我们可以逐步添加功能来定位问题。 